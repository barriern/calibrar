<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting started with the `calibrar` package • calibrar</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting started with the `calibrar` package">
<meta property="og:description" content="calibrar">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">calibrar</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.0.9020</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/v01-introduction.html">Getting started with the `calibrar` package</a>
    </li>
    <li>
      <a href="../articles/v02-parameter_estimation.html">Using the 'calibrate' function for parameter estimation</a>
    </li>
    <li>
      <a href="../articles/v03-parameter_estimation_ODE.html">Parameter estimation for ODE systems</a>
    </li>
    <li>
      <a href="../articles/v04-parameter_estimation_stochastic.html">Parameter estimation for stochastic models</a>
    </li>
    <li>
      <a href="../articles/v05-using_with_TMB.html">Using the calibrar package with TMB</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/roliveros-ramos/calibrar/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting started with the <code>calibrar</code>
package</h1>
                        <h4 data-toc-skip class="author">Ricardo
Oliveros-Ramos</h4>
            
            <h4 data-toc-skip class="date">2023-10-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/roliveros-ramos/calibrar/blob/HEAD/vignettes/v01-introduction.Rmd" class="external-link"><code>vignettes/v01-introduction.Rmd</code></a></small>
      <div class="hidden name"><code>v01-introduction.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This package allows the parameter estimation (i.e. calibration) of
complex models, including stochastic ones. It implements generic
functions that can be used for fitting any type of models, especially
those with non-differentiable objective functions, with the same syntax
as <code>base::optim</code>. It supports multiple phases estimation
(sequential parameter masking), constrained optimization (bounding box
restrictions) and automatic parallel computation of numerical gradients.
Some common maximum likelihood estimation methods and automated
construction of the objective function from simulated model outputs is
provided.</p>
</div>
<div class="section level2">
<h2 id="basic-usage">Basic usage<a class="anchor" aria-label="anchor" href="#basic-usage"></a>
</h2>
<p>This vignette covers the basic usage of the package, introducing the
functions <code><a href="../reference/optim2.html">optim2()</a></code>, <code><a href="../reference/optimh.html">optimh()</a></code> and
<code><a href="../reference/calibrate.html">calibrate()</a></code>.</p>
<div class="section level3">
<h3 id="optim2">optim2()<a class="anchor" aria-label="anchor" href="#optim2"></a>
</h3>
<p>As the name sugests, <code><a href="../reference/optim2.html">optim2()</a></code> is intended to extend the
functionality of <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">stats::optim()</a></code> and it uses the same
arguments:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/optim2.html">optim2</a></span><span class="op">(</span></span>
<span>  <span class="va">par</span>,</span>
<span>  <span class="va">fn</span>,</span>
<span>  gr <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Nelder-Mead"</span>, <span class="st">"BFGS"</span>, <span class="st">"CG"</span>, <span class="st">"L-BFGS-B"</span>, <span class="st">"SANN"</span>, <span class="st">"Brent"</span>, <span class="st">"nlm"</span>, <span class="st">"nlminb"</span>,</span>
<span>    <span class="st">"Rcgmin"</span>, <span class="st">"Rvmmin"</span>, <span class="st">"hjn"</span>, <span class="st">"spg"</span>, <span class="st">"LBFGSB3"</span>, <span class="st">"AHR-ES"</span><span class="op">)</span>,</span>
<span>  lower <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,</span>
<span>  upper <span class="op">=</span> <span class="op">+</span><span class="cn">Inf</span>,</span>
<span>  active <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  hessian <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The first difference is the possible values for the
<code>method</code> argument. In addition to the first six also
available in <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim()</a></code>, <code><a href="../reference/optim2.html">optim2()</a></code> gives access to
<code><a href="https://rdrr.io/r/stats/nlm.html" class="external-link">stats::nlm()</a></code> and <code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">stats::nlminb()</a></code> but with the
same syntax as <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim()</a></code> to make them easy to use. In
addition, three methods from the <code>optimr</code> package
(<code>Rcgmin</code>, <code>Rvmmin</code>, <code>hjn</code>), the
L-BFGS-B v3 implemented in the <code>bfgsb3c</code> package and the
<code>AHR-ES</code> (Adaptative Hierarchical Recombination Evolutionary
Strategy) implemented in this package.</p>
<p>In the next example, we compare the outputs of <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim()</a></code>
and <code><a href="../reference/optim2.html">optim2()</a></code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://roliveros-ramos.github.io/calibrar/" class="external-link">calibrar</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></span><span class="op">(</span>par<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>, fn<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $par</span></span>
<span><span class="co">#&gt; [1] -1.931714e-04 -3.044063e-04 -1.744066e-04  1.940552e-05  5.641574e-05</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $value</span></span>
<span><span class="co">#&gt; [1] 1.639553e-07</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $counts</span></span>
<span><span class="co">#&gt; function gradient </span></span>
<span><span class="co">#&gt;      456       NA </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $convergence</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/optim2.html">optim2</a></span><span class="op">(</span>par<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>, fn<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $par</span></span>
<span><span class="co">#&gt; [1] -1.931714e-04 -3.044063e-04 -1.744066e-04  1.940552e-05  5.641574e-05</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $value</span></span>
<span><span class="co">#&gt; [1] 1.639553e-07</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $counts</span></span>
<span><span class="co">#&gt; function gradient </span></span>
<span><span class="co">#&gt;      456       NA </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $convergence</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>The results are identical, as here <code><a href="../reference/optim2.html">optim2()</a></code> acts just as
a wrapper for <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim()</a></code>. Now, we can run the same example
with two other methods:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/optim2.html">optim2</a></span><span class="op">(</span>par<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>, fn<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, method<span class="op">=</span><span class="st">"nlm"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $par</span></span>
<span><span class="co">#&gt; [1] -2.500222e-13 -2.500222e-13 -2.500222e-13 -2.500222e-13 -2.500222e-13</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $value</span></span>
<span><span class="co">#&gt; [1] 3.125556e-25</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $counts</span></span>
<span><span class="co">#&gt; function gradient </span></span>
<span><span class="co">#&gt;       NA       NA </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $convergence</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; [1] "Relative gradient is close to zero, current iterate is probably solution."</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">880820</span><span class="op">)</span> <span class="co"># for reproducibility</span></span>
<span><span class="fu"><a href="../reference/optim2.html">optim2</a></span><span class="op">(</span>par<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>, fn<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, method<span class="op">=</span><span class="st">"AHR-ES"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $par</span></span>
<span><span class="co">#&gt; [1]  3.614506e-09 -1.750523e-08  3.238956e-09 -2.665415e-09  6.881578e-09</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $value</span></span>
<span><span class="co">#&gt; [1] 3.844491e-16</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $counts</span></span>
<span><span class="co">#&gt; function gradient </span></span>
<span><span class="co">#&gt;      848        0 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $convergence</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>The second difference is the new argument <code>active</code>, which
is a vector indicating if a parameters will be optimized (i.e. active)
or fixed during the optimization process. In the next example, we will
fix the third and fourth parameters to its initial values:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/optim2.html">optim2</a></span><span class="op">(</span>par<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>, fn<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, </span>
<span>       active<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in paropt[isActive] &lt;- output$par: number of items to replace is not a</span></span>
<span><span class="co">#&gt; multiple of replacement length</span></span>
<span><span class="co">#&gt; $par</span></span>
<span><span class="co">#&gt; [1] 1.062264e-05 1.167696e-04 1.000000e+00 1.000000e+00 5.492100e-05</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $value</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $counts</span></span>
<span><span class="co">#&gt; function gradient </span></span>
<span><span class="co">#&gt;      202       NA </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $convergence</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>As we can see, in the final solution, the <code>par</code>value keep
the values at 1, the initial value. All the numerical gradients computed
internally have also ‘masked’ this parameters and the derivatives are
not computed for them to speed up computation time.</p>
<p>Finally, the third difference is the new argument
<code>parallel</code>, that active the parallel computation of the
numerical gradient, when <code>gr</code> is not supplied:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/optim2.html">optim2</a></span><span class="op">(</span>par<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>, fn<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, parallel<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; $par</span></span>
<span><span class="co">#&gt; [1] -1.931714e-04 -3.044063e-04 -1.744066e-04  1.940552e-05  5.641574e-05</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $value</span></span>
<span><span class="co">#&gt; [1] 1.639553e-07</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $counts</span></span>
<span><span class="co">#&gt; function gradient </span></span>
<span><span class="co">#&gt;      456       NA </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $convergence</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>This last option will increase performance when the computation time
of <code>fn</code> in considerable. We will explain in detail this
feature in a following section.</p>
<p>Additionally, the method for the computation of the numerical
gradient can be chosen within the <code>control</code> list:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/optim2.html">optim2</a></span><span class="op">(</span>par<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">5</span><span class="op">)</span>, fn<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">x</span><span class="op">^</span><span class="op">(</span><span class="fl">3.1</span><span class="op">*</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>gr.method<span class="op">=</span><span class="st">"richardson"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/optim2.html">optim2</a></span><span class="op">(</span>par<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">5</span><span class="op">)</span>, fn<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">x</span><span class="op">^</span><span class="op">(</span><span class="fl">3.1</span><span class="op">*</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>gr.method<span class="op">=</span><span class="st">"central"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/optim2.html">optim2</a></span><span class="op">(</span>par<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">5</span><span class="op">)</span>, fn<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">x</span><span class="op">^</span><span class="op">(</span><span class="fl">3.1</span><span class="op">*</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>gr.method<span class="op">=</span><span class="st">"forward"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="optimh">optimh()<a class="anchor" aria-label="anchor" href="#optimh"></a>
</h3>
<p>The function <code><a href="../reference/optimh.html">optimh()</a></code> has a similar functionality as
<code><a href="../reference/optim2.html">optim2()</a></code> but acts as a wrapper for several heuristic
optimization algorithms implemented in several packages:
<code>dfoptim</code>, <code>optimr</code>, <code>minqa</code>,
<code>cmaes</code>, <code>genSA</code>, <code>DEoptim</code>,
<code>soma</code>, <code>rgenoud</code> and <code>psoptim</code>. The
<code><a href="../reference/optimh.html">optimh()</a></code> function standardizes the inputs and outputs to
those of <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim()</a></code>, providing a more convinient interface.
All specific arguments of this methods can be passed to the original
function using the <code>control</code> argument.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/optimh.html">optimh</a></span><span class="op">(</span></span>
<span>  <span class="va">par</span>,</span>
<span>  <span class="va">fn</span>,</span>
<span>  gr <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AHR-ES"</span>, <span class="st">"Nelder-Mead"</span>, <span class="st">"SANN"</span>, <span class="st">"hjn"</span>, <span class="st">"CMA-ES"</span>, <span class="st">"genSA"</span>, <span class="st">"DE"</span>, <span class="st">"soma"</span>,</span>
<span>    <span class="st">"genoud"</span>, <span class="st">"PSO"</span>, <span class="st">"hybridPSO"</span>, <span class="st">"mads"</span>, <span class="st">"hjk"</span>, <span class="st">"hjkb"</span>, <span class="st">"nmk"</span>, <span class="st">"nmkb"</span><span class="op">)</span>,</span>
<span>  lower <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,</span>
<span>  upper <span class="op">=</span> <span class="op">+</span><span class="cn">Inf</span>,</span>
<span>  active <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  hessian <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Covariance Matrix Adaptation Evolutionary Strategy</span></span>
<span><span class="fu"><a href="../reference/optimh.html">optimh</a></span><span class="op">(</span>par<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>, fn<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, method<span class="op">=</span><span class="st">"CMA-ES"</span>,</span>
<span>       control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxit<span class="op">=</span><span class="fl">3000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $par</span></span>
<span><span class="co">#&gt; [1]  5.444754e-82 -2.907902e-83  8.716819e-82 -4.292098e-82  9.848324e-83</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $value</span></span>
<span><span class="co">#&gt; [1] 1.251048e-162</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $counts</span></span>
<span><span class="co">#&gt; function gradient </span></span>
<span><span class="co">#&gt;    13000       NA </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $convergence</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; [1] "All standard deviations smaller than tolerance."</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generalized Simulated Anneling</span></span>
<span><span class="fu"><a href="../reference/optimh.html">optimh</a></span><span class="op">(</span>par<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>, fn<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, method<span class="op">=</span><span class="st">"genSA"</span>, </span>
<span>       lower<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100</span>, <span class="fl">5</span><span class="op">)</span>, upper<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>       control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxit<span class="op">=</span><span class="fl">1000</span>, temperature<span class="op">=</span><span class="fl">6000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $par</span></span>
<span><span class="co">#&gt; [1] 6.988898e-11 6.988898e-11 6.988898e-11 6.988898e-11 6.988898e-11</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $value</span></span>
<span><span class="co">#&gt; [1] 2.442235e-20</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $counts</span></span>
<span><span class="co">#&gt; function gradient </span></span>
<span><span class="co">#&gt;    10024        0 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $convergence</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; [1] NA</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Self-Organising Migrating Algorithm</span></span>
<span><span class="fu"><a href="../reference/optimh.html">optimh</a></span><span class="op">(</span>par<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>, fn<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, method<span class="op">=</span><span class="st">"soma"</span>,</span>
<span>       lower<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100</span>, <span class="fl">5</span><span class="op">)</span>, upper<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>       control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>populationSize<span class="op">=</span><span class="fl">12</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $par</span></span>
<span><span class="co">#&gt; [1] 0.050871847 2.180140196 0.009415949 0.249220674 0.774047001</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $value</span></span>
<span><span class="co">#&gt; [1] 5.416948</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $counts</span></span>
<span><span class="co">#&gt; function gradient </span></span>
<span><span class="co">#&gt;      200       NA </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $convergence</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; [1] NA</span></span></code></pre></div>
<p>You can refer to the help pages from each package to have details
about every specific method and its control arguments.</p>
</div>
<div class="section level3">
<h3 id="running-in-parallel">Running in parallel<a class="anchor" aria-label="anchor" href="#running-in-parallel"></a>
</h3>
<p>Most algorithms implemented in <code><a href="../reference/optim2.html">optim2()</a></code> and some in
<code>optimh</code> can benefit of parallel computation. For the methods
that uses the numerical computation of the gradient, this will be
calculated in parallel. In order to support any type of parallel
implementation, the parallel setup is NOT automatic, and must be done by
the user previous to executed the optimization, as described in the
following example:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span>
<span><span class="va">ncores</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span> <span class="co"># number of cores to be used</span></span>
<span><span class="va">cl</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="va">ncores</span><span class="op">)</span></span>
<span><span class="co"># this is slower than sequential for very fast models (like this one)</span></span>
<span><span class="fu"><a href="../reference/optim2.html">optim2</a></span><span class="op">(</span>par<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">5</span><span class="op">)</span>, fn<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, </span>
<span>               control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ncores<span class="op">=</span><span class="va">ncores</span><span class="op">)</span>, parallel<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; $par</span></span>
<span><span class="co">#&gt; [1] -9.658568e-05 -1.522031e-04 -8.720332e-05  9.702761e-06  2.820787e-05</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $value</span></span>
<span><span class="co">#&gt; [1] 4.098883e-08</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $counts</span></span>
<span><span class="co">#&gt; function gradient </span></span>
<span><span class="co">#&gt;      456       NA </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $convergence</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $message</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">stopCluster</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span> <span class="co"># close the parallel connections</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="sequential-parameter-estimation">Sequential parameter estimation<a class="anchor" aria-label="anchor" href="#sequential-parameter-estimation"></a>
</h2>
<div class="section level3">
<h3 id="calibrate">calibrate()<a class="anchor" aria-label="anchor" href="#calibrate"></a>
</h3>
<p>The <code><a href="../reference/calibrate.html">calibrate()</a></code> function implements an automatic
sequential parameter estimation, meaning parameters can be masked (set
active) progressively during sequential phases of the calibration
process.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/calibrate.html">calibrate</a></span><span class="op">(</span></span>
<span>  <span class="va">par</span>,</span>
<span>  <span class="va">fn</span>,</span>
<span>  gr <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  method <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  lower <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  upper <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  phases <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  hessian <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  replicates <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>With the basic syntax, the <code><a href="../reference/calibrate.html">calibrate()</a></code> function will
work similarly to <code><a href="../reference/optim2.html">optim2()</a></code> and <code><a href="../reference/optimh.html">optimh()</a></code>,
performing a simple optimization:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/calibrate.html">calibrate</a></span><span class="op">(</span>par<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="cn">NA</span>,<span class="cn">NA</span><span class="op">)</span>, fn<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Phase 1 finished in 0.01s (5 of 5 parameters active)</span></span>
<span><span class="co">#&gt; Function value: 1.25e-16</span></span>
<span><span class="co">#&gt; Parameter values: -5e-09 -5e-09 -5e-09 -5e-09 -5e-09</span></span>
<span><span class="co">#&gt; Calibration finished.</span></span>
<span><span class="co">#&gt; Function value: 1.25e-16 </span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt; [1] -5.000000e-09 -5.000001e-09 -5.000001e-09 -5.000000e-09 -5.000000e-09</span></span></code></pre></div>
<p>If <code>upper</code> and <code>lower</code> bounds are provided, the
calibrate function can take <code>NA</code> as starting values for the
optimization, to some or all of the parameters:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/calibrate.html">calibrate</a></span><span class="op">(</span>par<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="cn">NA</span>,<span class="fl">5</span><span class="op">)</span>, fn<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>          lower<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100</span>, <span class="fl">5</span><span class="op">)</span>, upper<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Phase 1 finished in 0.00s (5 of 5 parameters active)</span></span>
<span><span class="co">#&gt; Function value: 1.25e-16</span></span>
<span><span class="co">#&gt; Parameter values: -5e-09 -5e-09 -5e-09 -5e-09 -5e-09</span></span>
<span><span class="co">#&gt; Calibration finished.</span></span>
<span><span class="co">#&gt; Function value: 1.250001e-16 </span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt; [1] -4.999999e-09 -5.000001e-09 -5.000002e-09 -5.000000e-09 -5.000004e-09</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="setting-up-a-calibration-with-multiple-phases-">Setting up a calibration with multiple phases.<a class="anchor" aria-label="anchor" href="#setting-up-a-calibration-with-multiple-phases-"></a>
</h3>
<p>Multiple <code>phases</code> can be set up by selecting a different
one for each parameter. The starting value of the optimization for each
phase is updated with the best parameters found in the previous
phase:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/calibrate.html">calibrate</a></span><span class="op">(</span>par<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="cn">NA</span>,<span class="fl">5</span><span class="op">)</span>, fn<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>          lower<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100</span>, <span class="fl">5</span><span class="op">)</span>, upper<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>          phases<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Phase 1 finished in 0.00s (2 of 5 parameters active)</span></span>
<span><span class="co">#&gt; Function value: 13</span></span>
<span><span class="co">#&gt; Parameter values: -3.61e-08 4.95e-09</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Phase 2 finished in 0.00s (4 of 5 parameters active)</span></span>
<span><span class="co">#&gt; Function value: 9</span></span>
<span><span class="co">#&gt; Parameter values: -1.2e-08 -1.07e-15 0 4.95e-09</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Phase 3 finished in 0.00s (5 of 5 parameters active)</span></span>
<span><span class="co">#&gt; Function value: 1.25e-16</span></span>
<span><span class="co">#&gt; Parameter values: -5e-09 -5e-09 -5e-09 -5e-09 -5e-09</span></span>
<span><span class="co">#&gt; Calibration finished.</span></span>
<span><span class="co">#&gt; Function value: 1.25e-16 </span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt; [1] -5.000000e-09 -5.000000e-09 -5.000001e-09 -5.000000e-09 -5.000000e-09</span></span></code></pre></div>
<p>When a phase is set to a negative number, the parameter is fixed at
its initial value during all the calibration and it is never
optimized:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/calibrate.html">calibrate</a></span><span class="op">(</span>par<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="cn">NA</span>,<span class="fl">5</span><span class="op">)</span>, fn<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>          lower<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100</span>, <span class="fl">5</span><span class="op">)</span>, upper<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>          phases<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="op">-</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Phase 1 finished in 0.00s (2 of 5 parameters active)</span></span>
<span><span class="co">#&gt; Function value: 13</span></span>
<span><span class="co">#&gt; Parameter values: -3.61e-08 4.95e-09</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Phase 2 finished in 0.00s (4 of 5 parameters active)</span></span>
<span><span class="co">#&gt; Function value: 9</span></span>
<span><span class="co">#&gt; Parameter values: -1.2e-08 -1.07e-15 0 4.95e-09</span></span>
<span><span class="co">#&gt; Calibration finished.</span></span>
<span><span class="co">#&gt; Function value: 9 </span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt; [1] -1.197001e-08 -1.073122e-15  3.000000e+00  0.000000e+00  4.954524e-09</span></span>
<span><span class="co">#&gt; * Parameters not calibrated.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="dealing-with-stochastic-functions">Dealing with stochastic functions<a class="anchor" aria-label="anchor" href="#dealing-with-stochastic-functions"></a>
</h3>
<p>When dealing with stochastic functions, the argument
<code>replicates</code> can be helful, as it allows to evaluate the
objective function several times, taking the average value of them as
the actual function value (as an approximation of the expected value of
the function). When <code>replicates=1</code>, the algorithm used by
default is “LBFGSB3”, but when replicates is greater than 1, “AHR-ES” is
used. The next examples use the function <code><a href="../reference/SphereN.html">sphereN()</a></code>, which
computes the Euclidian distance from a point <code>x</code> to the
origin of coordinates after a random displacement of its position
(<code><a href="../reference/SphereN.html">?sphereN</a></code> for details.)</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/calibrate.html">calibrate</a></span><span class="op">(</span>par<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="cn">NA</span>,<span class="fl">5</span><span class="op">)</span>, fn<span class="op">=</span><span class="va">sphereN</span>,</span>
<span>          lower<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100</span>, <span class="fl">5</span><span class="op">)</span>, upper<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>          phases<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, replicates<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Phase 1 finished in 0.47s (2 of 5 parameters active)</span></span>
<span><span class="co">#&gt; Function value: 12.4556</span></span>
<span><span class="co">#&gt; Parameter values: -0.101 0.181</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Phase 2 finished in 0.34s (4 of 5 parameters active)</span></span>
<span><span class="co">#&gt; Function value: 9.85428</span></span>
<span><span class="co">#&gt; Parameter values: -0.206 0.102 -0.239 0.00227</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Phase 3 finished in 1.16s (5 of 5 parameters active)</span></span>
<span><span class="co">#&gt; Function value: 0.0882644</span></span>
<span><span class="co">#&gt; Parameter values: 0.056 -0.0556 0.00026 -0.0198 0.0269</span></span>
<span><span class="co">#&gt; Calibration finished.</span></span>
<span><span class="co">#&gt; Function value: 0.08826441 </span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt; [1]  0.0559909147 -0.0556479454  0.0002599531 -0.0198389082  0.0269479972</span></span></code></pre></div>
<p>The number of replicates can be one single value or a vector with the
length equal to the number of phases:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/calibrate.html">calibrate</a></span><span class="op">(</span>par<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="cn">NA</span>,<span class="fl">5</span><span class="op">)</span>, fn<span class="op">=</span><span class="va">sphereN</span>,</span>
<span>          lower<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100</span>, <span class="fl">5</span><span class="op">)</span>, upper<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>          phases<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, replicates<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Phase 1 finished in 0.33s (2 of 5 parameters active)</span></span>
<span><span class="co">#&gt; Function value: 12.3034</span></span>
<span><span class="co">#&gt; Parameter values: 0.128 -0.538</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Phase 2 finished in 0.44s (4 of 5 parameters active)</span></span>
<span><span class="co">#&gt; Function value: 10.2389</span></span>
<span><span class="co">#&gt; Parameter values: -0.317 0.167 -0.0369 -0.518</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Phase 3 finished in 0.55s (5 of 5 parameters active)</span></span>
<span><span class="co">#&gt; Function value: 0.0461545</span></span>
<span><span class="co">#&gt; Parameter values: 0.00374 0.00569 0.0155 -0.00557 0.0374</span></span>
<span><span class="co">#&gt; Calibration finished.</span></span>
<span><span class="co">#&gt; Function value: 0.04615452 </span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt; [1]  0.003737875  0.005691088  0.015540000 -0.005568337  0.037400297</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="parameters-as-lists">Parameters as lists<a class="anchor" aria-label="anchor" href="#parameters-as-lists"></a>
</h3>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/calibrate.html">calibrate</a></span><span class="op">(</span>par<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>par1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>, par2<span class="op">=</span><span class="cn">NA</span>, par3<span class="op">=</span><span class="fl">5</span><span class="op">)</span>, fn<span class="op">=</span><span class="va">sphereN</span>,</span>
<span>          lower<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100</span>, <span class="fl">5</span><span class="op">)</span>, upper<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>          phases<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="op">-</span><span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, replicates<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Phase 1 finished in 0.52s (2 of 5 parameters active)</span></span>
<span><span class="co">#&gt; Function value: 12.5624</span></span>
<span><span class="co">#&gt; Parameter values: -0.218 -0.141</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Phase 2 finished in 1.42s (4 of 5 parameters active)</span></span>
<span><span class="co">#&gt; Function value: 9.12881</span></span>
<span><span class="co">#&gt; Parameter values: 0.04 -0.181 0.181 0.0217</span></span>
<span><span class="co">#&gt; Calibration finished.</span></span>
<span><span class="co">#&gt; Function value: 9.128808 </span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt; $par1</span></span>
<span><span class="co">#&gt; [1]  0.04003773 -0.18090636  3.00000000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $par2</span></span>
<span><span class="co">#&gt; [1] 0.1806547</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $par3</span></span>
<span><span class="co">#&gt; [1] 0.0217072</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; * Parameters not calibrated.</span></span></code></pre></div>
<p>Note that the function <code>fn</code> must be able to take a list as
parameter set, and the user must ensure this works before hand.</p>
</div>
<div class="section level3">
<h3 id="running-in-parallel-1">Running in parallel<a class="anchor" aria-label="anchor" href="#running-in-parallel-1"></a>
</h3>
<p>Most algorithms implemented in the <code>calibrate</code> function
can benefit of parallel computation. For the methods that uses the
numerical computation of the gradient, this will be calculated in
parallel as in <code><a href="../reference/optim2.html">optim2()</a></code>. In order to support any type of
parallel implementation, the parallel setup is NOT automatic, and must
be done by the user previous to executed the optimization, as described
in the following example:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span>
<span><span class="va">ncores</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span> <span class="co"># number of cores to be used</span></span>
<span><span class="va">cl</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="va">ncores</span><span class="op">)</span></span>
<span><span class="co"># this is slower than sequential for very fast models (like this one)</span></span>
<span><span class="va">calib</span> <span class="op">=</span> <span class="fu"><a href="../reference/calibrate.html">calibrate</a></span><span class="op">(</span>par<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">5</span><span class="op">)</span>, fn<span class="op">=</span><span class="va">sphereN</span>,</span>
<span>                  replicates<span class="op">=</span><span class="fl">3</span>, </span>
<span>                  lower<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>, </span>
<span>                  upper<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">+</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>, </span>
<span>                  phases<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>, </span>
<span>                  control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>parallel<span class="op">=</span><span class="cn">TRUE</span>, ncores<span class="op">=</span><span class="va">ncores</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">stopCluster</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span> <span class="co"># close the parallel connections</span></span></code></pre></div>
<p>Please, refer to <code>vignette(package="calibrar")</code> for
additional vignettes or to the <a href="http://roliveros-ramos.github.io/calibrar" class="external-link">calibrar website</a>
for more details.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Ricardo Oliveros-Ramos.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
